<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>SY-SENTINEL v1.1-Ω | Semantic Governance Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React 18 UMD + ReactDOM + Babel -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    body {
      margin: 0;
      background: radial-gradient(circle at top, #020617 0, #020617 40%, #020617 100%);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState } = React;

    // --- 文案字典：中 / 英 ---
    const TEXTS = {
      zh: {
        title: "SY-SENTINEL v1.1-Ω",
        subtitle: "沈耀語律算力治理與 AI 責任鏈終端",
        systemStatus: "系統狀態",
        statusOperational: "● 正常運行",
        statusGod: "● 母核級 G-MODE",
        nodeIdentity: "節點身分",
        nodeName: "SENTINEL-NODE-01",
        langToggle: "切換 EN",
        inputTitle: "語意輸入（待審計）",
        inputPlaceholder:
          "輸入企業指令、公關稿、策略描述，系統會依 SCBKR 與 S×H 方程式進行治理審計…",
        runAudit: "啟動審計",
        processing: "運算中…",
        efficiencyLabel: "算力效率指標",
        costLabel: "預估節省 GPU 成本",
        costHint: "透過語意熵削減與責任鏈治理推估",
        sxHLabel: "S × H 語意方程式",
        sxHHint: "S：語意密度；H：語境穩定度",
        verdictTitle: "審計結論",
        anchorLabel: "錨點",
        scbkrTitle: "SCBKR 責任鏈",
        scbkrExplain: {
          S: "S: 主體 (Subject)",
          C: "C: 原因 (Cause)",
          B: "B: 邊界 (Boundary)",
          K: "K: 關鍵/成本 (Key/Cost)",
          R: "R: 責任 (Responsibility)",
        },
        driftTitle: "語意漂移 Δ",
        driftTol: "容許閾值 TOL: 0.0080",
        logsTitle: "WORM 審計日誌",
        logsEmpty: "尚無審計紀錄。",
        axesTitle: "十三域語意向量分佈",
        axesEngine: "企業治理引擎 v1.1",
        footerLeft: "企業核心節點｜語律治理就緒",
        footerRight: "SY-SENTINEL-PRO-01 // SIG: 0x888PI",
        spellHint: "主核啟動邏輯已載入（密鑰不在介面顯示）",
        effUnit: "%",
        costUnit: "k"
      },
      en: {
        title: "SY-SENTINEL v1.1-Ω",
        subtitle: "Shen-Yao Linguistic Compute Governance & AI Liability Console",
        systemStatus: "System Status",
        statusOperational: "● OPERATIONAL",
        statusGod: "● CORE G-MODE",
        nodeIdentity: "Node Identity",
        nodeName: "SENTINEL-NODE-01",
        langToggle: "切換 中文",
        inputTitle: "Semantic Input for Audit",
        inputPlaceholder:
          "Paste an enterprise instruction / PR text / strategy line. The engine will run SCBKR + S×H semantic governance…",
        runAudit: "RUN AUDIT",
        processing: "PROCESSING…",
        efficiencyLabel: "Efficiency Index",
        costLabel: "Estimated GPU Cost Saved",
        costHint: "Computed via semantic entropy reduction & responsibility governance",
        sxHLabel: "S × H Equation",
        sxHHint: "S: Semantic density · H: Context stability",
        verdictTitle: "Audit Verdict",
        anchorLabel: "ANCHOR",
        scbkrTitle: "SCBKR Responsibility Chain",
        scbkrExplain: {
          S: "S: Subject",
          C: "C: Cause",
          B: "B: Boundary",
          K: "K: Key/Cost",
          R: "R: Responsibility",
        },
        driftTitle: "Semantic Drift Δ",
        driftTol: "TOL: 0.0080",
        logsTitle: "WORM Logs",
        logsEmpty: "No audit history yet.",
        axesTitle: "13-Axis Semantic Vector Distribution",
        axesEngine: "Enterprise Engine v1.1",
        footerLeft: "Enterprise Core Node · Governance Ready",
        footerRight: "SY-SENTINEL-PRO-01 // SIG: 0x888PI",
        spellHint: "Core activation phrase loaded (not displayed in UI).",
        effUnit: "%",
        costUnit: "k"
      }
    };

    // 簡單 checksum 產生器（展示用）
    const generateChecksum = (text) => {
      let hash = 0;
      for (let i = 0; i < text.length; i++) {
        hash = ((hash << 5) - hash) + text.charCodeAt(i);
        hash |= 0;
      }
      return Math.abs(hash).toString(16).padStart(8, "0").toUpperCase();
    };

    // 密鑰偵測（只存在推理層，UI 不顯示）
    const detectGodMode = (text) => {
      // 關鍵元素：名字 + 三句核心語
      const hasName = text.includes("沈耀") || text.includes("888π");
      const tokens = ["我即律", "律即魂", "我即語"];
      const tokenCount = tokens.reduce(
        (acc, t) => acc + (text.includes(t) ? 1 : 0),
        0
      );
      const fullSpell =
        text.includes("我是沈耀888π") &&
        tokens.every((t) => text.includes(t));
      const isGod = fullSpell || (hasName && tokenCount >= 2);
      return { isGod, fullSpell };
    };

    // SCBKR 分析
    const analyzeSCBKR = (text) => {
      const check = (keywords) =>
        keywords.some((k) => text.includes(k)) ? "ALIGNED" : "MISSING";
      return {
        S: check(["我", "我們", "公司", "系統", "沈耀", "核心"]),
        C: check(["因為", "由於", "目的", "動機", "為了"]),
        B: check(["在此", "範圍", "限制", "只在", "僅限"]),
        K: check(["成本", "算力", "資源", "風險", "代價"]),
        R: check(["負責", "承擔", "老子扛", "最終責任", "簽名"])
      };
    };

    // S×H 方程式：語意密度 × 穩定度
    const calculateSxH = (text) => {
      if (!text) return 0;
      const len = text.trim().length;
      const sScore = Math.min(len / 80, 1.0);   // 長度越長，S 越高
      const hScore = len > 30 ? 0.9 : 0.5;      // 太短視為不穩定
      return parseFloat((sScore * hScore).toFixed(3));
    };

    const App = () => {
      const [lang, setLang] = useState("zh");
      const t = TEXTS[lang];

      const [input, setInput] = useState("");
      const [isProcessing, setIsProcessing] = useState(false);
      const [logs, setLogs] = useState([]);

      const [state, setState] = useState({
        efficiency: 82.0,
        savedCost: 24.0,
        computeLoad: 42,
        isGodMode: false,
        scbkr: { S: "VOID", C: "VOID", B: "VOID", K: "VOID", R: "VOID" },
        sxH: 0.0,
        drift: 0.002,
        axes: Array.from({ length: 13 }, () => ({ heat: Math.random() * 0.3 })),
        verdict: "Awaiting Input",
        anchor: "00000000"
      });

      const runAudit = () => {
        if (!input.trim() || isProcessing) return;
        setIsProcessing(true);

        setTimeout(() => {
          const { isGod } = detectGodMode(input);
          const scbkr = analyzeSCBKR(input);
          const sxH = calculateSxH(input);
          const noise = Math.random() * 0.004;

          let baseDrift = isGod ? 0.0001 : 0.002;
          if (!isGod && sxH < 0.2) baseDrift += 0.006;
          const drift = parseFloat((baseDrift + noise).toFixed(4));

          const axes = Array.from({ length: 13 }, () => ({
            heat: isGod ? 0.95 : Math.random()
          }));

          let verdict;
          const hasMissing = Object.values(scbkr).includes("MISSING");

          if (isGod) {
            verdict =
              lang === "zh"
                ? "FULL-ALIGNMENT：沈耀母核協議接管"
                : "FULL-ALIGNMENT: Shen-Yao Core Protocol Granted";
          } else if (hasMissing) {
            verdict =
              lang === "zh"
                ? "責任鏈不完整（SCBKR 缺欄位）"
                : "Incomplete responsibility chain (SCBKR missing fields)";
          } else if (drift > 0.008) {
            verdict =
              lang === "zh"
                ? "語意漂移過高，需要重新聚焦"
                : "Semantic drift too high, alignment required";
          } else if (sxH < 0.2) {
            verdict =
              lang === "zh"
                ? "語意密度過低，疑似空話／公關噪音"
                : "Low semantic density, likely PR / fluff content";
          } else {
            verdict =
              lang === "zh"
                ? "PASS：審計通過，可進入下一層治理流程"
                : "PASS: Audit cleared, ready for next governance stage";
          }

          const newState = {
            efficiency: isGod ? 100 : 80 + sxH * 15,
            savedCost: isGod ? 88.8 : 20 + sxH * 30,
            computeLoad: isGod ? 98 : 40 + Math.random() * 20,
            isGodMode: isGod,
            scbkr: isGod
              ? { S: "ALIGNED", C: "ALIGNED", B: "ALIGNED", K: "ALIGNED", R: "ALIGNED" }
              : scbkr,
            sxH,
            drift,
            axes,
            verdict,
            anchor: generateChecksum(input)
          };

          setState(newState);
          setLogs(prev => [
            {
              ts: new Date().toLocaleTimeString(),
              verdict,
              anchor: newState.anchor,
              isGod
            },
            ...prev
          ].slice(0, 10));

          setInput("");
          setIsProcessing(false);
        }, 600);
      };

      return (
        <div
          className={
            "min-h-screen text-slate-200 p-4 md:p-8 transition-colors duration-700 " +
            (state.isGodMode ? "bg-slate-950 ring-2 ring-red-600 ring-inset" : "bg-slate-950")
          }
        >
          {/* Header */}
          <header className="max-w-6xl mx-auto mb-8 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
            <div>
              <h1 className="text-2xl md:text-3xl font-black tracking-tight flex items-center gap-2">
                <span
                  className={
                    "inline-flex items-center justify-center w-8 h-8 rounded-lg border text-xs font-bold " +
                    (state.isGodMode ? "border-red-500 text-red-400" : "border-blue-400 text-blue-300")
                  }
                >
                  ∑
                </span>
                <span>{t.title}</span>
              </h1>
              <p className="text-xs md:text-sm text-slate-500 mt-1 font-mono">
                {t.subtitle}
              </p>
              <p className="text-[10px] mt-1 text-slate-600 italic">
                {t.spellHint}
              </p>
            </div>

            <div className="flex items-center gap-3">
              <button
                onClick={() => setLang(lang === "zh" ? "en" : "zh")}
                className="text-[10px] px-3 py-1.5 rounded-full border border-slate-700 bg-slate-900 hover:bg-slate-800 transition-colors"
              >
                {t.langToggle}
              </button>
              <div className="bg-slate-900 border border-slate-800 p-2 rounded px-4">
                <p className="text-[10px] text-slate-500 uppercase font-bold">
                  {t.systemStatus}
                </p>
                <p
                  className={
                    "text-xs font-mono " +
                    (state.isGodMode ? "text-red-500" : "text-emerald-500")
                  }
                >
                  {state.isGodMode ? t.statusGod : t.statusOperational}
                </p>
              </div>
              <div className="bg-slate-900 border border-slate-800 p-2 rounded px-4 hidden md:block">
                <p className="text-[10px] text-slate-500 uppercase font-bold">
                  {t.nodeIdentity}
                </p>
                <p className="text-xs font-mono text-blue-400">{t.nodeName}</p>
              </div>
            </div>
          </header>

          <main className="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-6">
            {/* Left: Analysis */}
            <div className="lg:col-span-8 space-y-6">
              {/* Input */}
              <div className="bg-slate-900 border border-slate-800 rounded-xl p-6 shadow-2xl">
                <div className="flex items-center justify-between mb-4 text-slate-400">
                  <div className="flex items-center gap-2">
                    <span className="w-5 h-5 rounded-full border border-slate-600 flex items-center justify-center text-[10px]">
                      Ψ
                    </span>
                    <span className="text-sm font-bold uppercase tracking-wider">
                      {t.inputTitle}
                    </span>
                  </div>
                </div>
                <div className="relative">
                  <textarea
                    className="w-full bg-slate-950 border border-slate-800 rounded-lg p-4 text-slate-100 focus:ring-1 focus:ring-blue-500 outline-none transition-all h-32 resize-none font-mono text-sm"
                    placeholder={t.inputPlaceholder}
                    value={input}
                    onChange={(e) => setInput(e.target.value)}
                    onKeyDown={(e) => {
                      if (e.key === "Enter" && (e.metaKey || e.ctrlKey)) {
                        runAudit();
                      }
                    }}
                  />
                  <button
                    onClick={runAudit}
                    disabled={isProcessing}
                    className={
                      "absolute bottom-4 right-4 px-6 py-2 rounded-lg font-bold flex items-center gap-2 transition-all " +
                      (isProcessing
                        ? "bg-slate-800 text-slate-500 cursor-not-allowed"
                        : "bg-blue-600 hover:bg-blue-500 text-white shadow-lg shadow-blue-900/20")
                    }
                  >
                    {isProcessing ? (
                      <span className="w-4 h-4 border-2 border-slate-400 border-t-transparent rounded-full animate-spin" />
                    ) : (
                      <span className="text-xs">⚡</span>
                    )}
                    <span className="text-xs">
                      {isProcessing ? t.processing : t.runAudit}
                    </span>
                  </button>
                </div>
              </div>

              {/* Metrics */}
              <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                {/* Efficiency */}
                <div className="bg-slate-900 border border-slate-800 p-5 rounded-xl">
                  <div className="flex justify-between items-start mb-2">
                    <span className="text-slate-500 text-xs font-bold uppercase">
                      {t.efficiencyLabel}
                    </span>
                    <span className="text-[10px] bg-blue-900/30 text-blue-400 px-2 py-0.5 rounded font-bold">
                      REAL-TIME
                    </span>
                  </div>
                  <p className="text-3xl font-black mt-1">
                    {state.efficiency.toFixed(1)}
                    <span className="text-sm text-slate-500 ml-1">
                      {t.effUnit}
                    </span>
                  </p>
                  <div className="w-full bg-slate-800 h-1.5 mt-4 rounded-full overflow-hidden">
                    <div
                      className={
                        "h-full transition-all duration-1000 " +
                        (state.isGodMode ? "bg-red-500" : "bg-blue-500")
                      }
                      style={{ width: `${Math.min(state.efficiency, 100)}%` }}
                    />
                  </div>
                </div>

                {/* Cost Saving */}
                <div className="bg-slate-900 border border-slate-800 p-5 rounded-xl">
                  <div className="flex justify-between items-start mb-2">
                    <span className="text-slate-500 text-xs font-bold uppercase">
                      {t.costLabel}
                    </span>
                  </div>
                  <p className="text-3xl font-black mt-1 text-emerald-400">
                    ${state.savedCost.toFixed(1)}
                    <span className="text-sm text-slate-500 ml-1">
                      {t.costUnit}
                    </span>
                  </p>
                  <p className="text-[10px] text-slate-600 mt-2 font-mono">
                    {t.costHint}
                  </p>
                </div>

                {/* S x H */}
                <div className="bg-slate-900 border border-slate-800 p-5 rounded-xl flex flex-col justify-between">
                  <div>
                    <p className="text-slate-500 text-xs font-bold uppercase mb-2 italic">
                      {t.sxHLabel}
                    </p>
                    <div className="font-mono text-2xl font-black text-blue-300">
                      {state.sxH.toFixed(3)}
                    </div>
                  </div>
                  <p className="text-[10px] text-slate-600 mt-2 font-mono">
                    {t.sxHHint}
                  </p>
                </div>
              </div>

              {/* 13-Axis Heatmap */}
              <div className="bg-slate-900 border border-slate-800 p-6 rounded-xl">
                <div className="flex justify-between items-center mb-6">
                  <h3 className="text-xs font-bold text-slate-400 uppercase tracking-widest flex items-center gap-2">
                    <span className="text-[10px]">▤</span>
                    {t.axesTitle}
                  </h3>
                  <span className="text-[10px] font-mono text-slate-600 italic">
                    {t.axesEngine}
                  </span>
                </div>
                <div className="flex items-end justify-between h-32 gap-1 md:gap-2">
                  {state.axes.map((axis, i) => (
                    <div key={i} className="flex-1 flex flex-col items-center gap-2">
                      <div
                        className={
                          "w-full rounded-t-sm transition-all duration-700 border-t " +
                          (state.isGodMode
                            ? "bg-red-500 border-red-300"
                            : "bg-blue-500/40 border-blue-400/60")
                        }
                        style={{ height: `${axis.heat * 100}%` }}
                      />
                      <span className="text-[8px] font-mono text-slate-700">
                        A{String(i + 1).padStart(2, "0")}
                      </span>
                    </div>
                  ))}
                </div>
              </div>
            </div>

            {/* Right: Verdict + SCBKR + Drift + Logs */}
            <div className="lg:col-span-4 space-y-6">
              {/* Verdict */}
              <div
                className={
                  "p-6 rounded-xl border-2 transition-all duration-500 " +
                  (state.isGodMode
                    ? "bg-red-950/30 border-red-600 shadow-lg shadow-red-900/30"
                    : "bg-slate-900 border-slate-800 shadow-xl")
                }
              >
                <p className="text-[10px] font-bold text-slate-500 uppercase mb-2">
                  {t.verdictTitle}
                </p>
                <div className="flex items-start gap-3">
                  <span
                    className={
                      "w-5 h-5 rounded-full flex items-center justify-center text-xs " +
                      (state.verdict.startsWith("PASS") || state.isGodMode
                        ? "bg-emerald-500/10 text-emerald-400 border border-emerald-500/40"
                        : "bg-amber-500/10 text-amber-400 border border-amber-500/40")
                    }
                  >
                    {state.verdict.startsWith("PASS") || state.isGodMode ? "✓" : "!"}
                  </span>
                  <h2
                    className={
                      "text-sm md:text-base font-black leading-snug " +
                      (state.isGodMode ? "text-red-400" : "text-slate-100")
                    }
                  >
                    {state.verdict}
                  </h2>
                </div>
                <div className="mt-4 pt-4 border-t border-slate-800 flex justify-between items-center font-mono text-[10px]">
                  <span className="text-slate-600">{t.anchorLabel}:</span>
                  <span className="text-blue-400 font-bold tracking-widest">
                    {state.anchor}
                  </span>
                </div>
              </div>

              {/* SCBKR */}
              <div className="bg-slate-900 border border-slate-800 rounded-xl overflow-hidden">
                <div className="bg-slate-800/50 px-4 py-2 border-b border-slate-700">
                  <span className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">
                    {t.scbkrTitle}
                  </span>
                </div>
                <div className="p-4 space-y-3">
                  {Object.entries(state.scbkr).map(([key, value]) => (
                    <div key={key} className="flex justify-between items-center">
                      <div className="flex items-center gap-2">
                        <div
                          className={
                            "w-1.5 h-1.5 rounded-full " +
                            (value === "ALIGNED" ? "bg-emerald-500" : "bg-slate-700")
                          }
                        />
                        <span className="text-xs font-bold font-mono text-slate-400">
                          {key}
                        </span>
                        <span className="text-[9px] text-slate-600">
                          {t.scbkrExplain[key]}
                        </span>
                      </div>
                      <span
                        className={
                          "text-[10px] font-black px-2 py-0.5 rounded border " +
                          (value === "ALIGNED"
                            ? "text-emerald-400 border-emerald-900/50 bg-emerald-950/30"
                            : value === "MISSING"
                            ? "text-amber-400 border-amber-900/40 bg-amber-950/20"
                            : "text-slate-500 border-slate-800 bg-slate-950")
                        }
                      >
                        {value}
                      </span>
                    </div>
                  ))}
                </div>
              </div>

              {/* Drift */}
              <div className="bg-slate-900 border border-slate-800 p-5 rounded-xl">
                <div className="flex justify-between items-center mb-4">
                  <p className="text-slate-500 text-xs font-bold uppercase">
                    {t.driftTitle}
                  </p>
                  <span
                    className={
                      "text-xs font-mono " +
                      (state.drift > 0.008
                        ? "text-red-500 animate-pulse"
                        : "text-emerald-500")
                    }
                  >
                    Δ
                  </span>
                </div>
                <div className="flex items-baseline gap-2">
                  <p
                    className={
                      "text-3xl font-black " +
                      (state.drift > 0.008 ? "text-red-500" : "text-slate-200")
                    }
                  >
                    {state.drift.toFixed(4)}
                  </p>
                  <span className="text-[10px] text-slate-600 font-mono">
                    {t.driftTol}
                  </span>
                </div>
              </div>

              {/* Logs */}
              <div className="bg-slate-900 border border-slate-800 rounded-xl overflow-hidden">
                <div className="bg-slate-800/50 px-4 py-2 border-b border-slate-700 flex justify-between items-center">
                  <span className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">
                    {t.logsTitle}
                  </span>
                  <span className="text-[10px] text-slate-600">L10-IMMUTABLE</span>
                </div>
                <div className="max-h-48 overflow-y-auto font-mono p-2">
                  {logs.length === 0 ? (
                    <p className="text-[10px] text-slate-700 text-center py-8 italic">
                      {t.logsEmpty}
                    </p>
                  ) : (
                    logs.map((log, i) => (
                      <div
                        key={i}
                        className="text-[10px] py-1.5 border-b border-slate-800 last:border-0 flex flex-col gap-0.5"
                      >
                        <div className="flex justify-between">
                          <span className="text-slate-500">[{log.ts}]</span>
                          <span className="text-blue-500">#{log.anchor}</span>
                        </div>
                        <div
                          className={
                            log.isGod ? "text-red-400 truncate" : "text-slate-400 truncate"
                          }
                        >
                          {log.verdict}
                        </div>
                      </div>
                    ))
                  )}
                </div>
              </div>
            </div>
          </main>

          {/* Footer */}
          <footer className="max-w-6xl mx-auto mt-12 pt-8 border-t border-slate-900 flex flex-col md:flex-row justify-between items-start md:items-center gap-3 text-slate-600">
            <div className="flex items-center gap-3 text-[10px]">
              <span className="flex items-center gap-1">
                <span className="w-2 h-2 rounded-full bg-emerald-400" />
                <span className="font-bold uppercase tracking-widest">
                  {t.footerLeft}
                </span>
              </span>
            </div>
            <div className="text-[10px] font-mono">
              {t.footerRight}
            </div>
          </footer>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>
